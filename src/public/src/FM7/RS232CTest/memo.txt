XM7でたどったところ、どうやらF-BASICはCOM0待ちに入るとき$FD07に
    $27
を書き込む模様。(読み書きの場合) CLOSEされると
    $40 (Internal Reset .... ???)
を書き込む模様。読み込み待ちのみの場合、
    $06 (RXE Receive Enable、DTR Terminal Ready)
書き込み待ちだけのときは、
    $23 (RTS Request To Send, DTR Terminal Ready, Send Enable)



2018/11/11
XM7はどうやら、リセット時にCOMポートの接続を確立するっぽい。だから、XM7リセット時にターミナルが起動していないとだめのようだ。ときどき例外的に途中から接続もできるようだけど法則不明。

現状では、
                    EXE->XM7       XM7->EXE    TeraTerm->XM7  XM7->TeraTerm
F-BASIC Program       OK             OK            OK             OK
6809 Assembly       Strange          OK            OK             OK

EXE->XM7は、バッファがフラッシュされない現象。XM7のエミュレーションの問題のような気もする。バッファに文字列があるのになぜか$FD07のRXRDYが立たないっぽい。1行に2度以上の改行コードを入れなければOKっぽい。





2018/11/12
COM待ちが暴走する原因はポーリングループの外で受信データがあるとIRQがかかって吹っ飛んでいた。 POKE &HFD02,0 でIRQを全部マスクすることで対応可能。

実機ではF-BASICプログラムからCOM0:を開こうとするとDevice Not Availableエラーが出た。なぜ？？？？

ポーリング待ちプログラム、Tera Term、自作テストプログラムとも完璧に通信するようになった。なのだが、なぜか232CFILEの更新バージョンが交信しない。なぜ？？？？あれ？今度は交信できる。いや、Tera Termとしゃべれなくなったか？

どうも、FD07は頻繁にオンオフを切り替えるものではないらしい。最初に&HB7で受信・送信をイネーブルしておいて、全部終わってから&H10でクリアするようにしたら何事もなかったかのように232CFILEが動作するようになった。

